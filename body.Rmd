---
output:
   pdf_document
---

# Introduction

This study examines the relationship between the legal and illegal tobacco markets in South Africa. Section \ref{data} discusses the data used and how it was cleaned. Section \ref{methodology} explains the methodology, where a VECM model is presented. The final section details discussion points (\ref{analysis}). The appendix contains the full model outputs. 


# The Illicit Tobacco Market

The health problems associated with tobacco consumption are significant and have been well-documented (Tingum et al, 2020:62). Worldwide, smoking is one of the leading causes of preventable deaths; and in South Africa 23% of the total deaths in 2018 were smoking-related (Statistics South Africa). Given the large and negative impact of smoking, the tobacco market has come under increasing scrutiny by governments and health organizations. A significant component of the tobacco market is the illicit cigarette trade, which the Financial Action Task Force (2012:7) defines as “…the supply, distribution and sale of smuggled genuine, counterfeit or cheap white tobacco products.”

The illicit tobacco market gives rise to concern on three main fronts: public health, tax evasion, and criminal activity. From a public health perspective, illicit cigarettes make smoking more affordable and thereby increases tobacco access (van der Zee et al, 2019:242). Cheaper cigarettes may induce non-smokers to smoke, increase the volume of cigarettes consumed by smokers, and decrease the likelihood that smokers will quit smoking (Pechacek et al, 2018:pagenumber; van der Zee et al, 2019:242).

According to the International Agency for Research on Cancer, tobacco use is more prevalent among low socio-economic groups, and the poor are more sensitive to cigarette prices (IARC, 2011:276). Consequently, the health problems linked to smoking are disproportionately higher among the poor, which results in a greater burden on the public healthcare sector (). In South Africa, the healthcare costs associated with smoking amounted to R14.48 billion in 2016, which accounted for 4.1% of health spending (). In addition to the healthcare costs, there are indirect costs linked to smoking such as the loss of productive lives and loss of productive days due to illness (Boachie et al, 2020). In 2016, the total cost of smoking to South Africa was R42.32 billion (0.97% of GDP).

Evidently, the public health and economic costs of tobacco use are extensive. In an effort to reduce tobacco use, many countries have implemented tax and price policies on tobacco products (Chaloupka, Straif, Leon). For a middle-income country, South Africa was considered to be at the forefront of tobacco control policies, including excise duties, for many years (Vellios ). From a fiscal perspective, excise tax on cigarettes is a source of government revenue, which is undermined by the illicit tobacco industry.  Blah ble estimates the loss of income due to the illicit market to be R123123 The loss of income





# Methodology \label{methodology}

## Theoretical Model \label{Model}
The long-run relationship between the legal cigarette market and the illicit market is modeled as a vector error correction model 

## Data \label{data}

The sample period for this study runs from January 2012 to March 2020. Monthly data is used such that there are 99 observation points for each variable in the data set. One of the advantages of using monthly data rather than annual data is that it allows for more degrees of freedom. The data used includes figures for the prices and volumes of cigarettes in South Africa, tobacco excise duties, VAT, and disposable income. 

To prepare the data for analysis the most popular price category (MPPC) was identified as the 20-cigarette pack. Then a weighted average of before-tax 20-pack prices was used as a base price. The excise duty per 20's pack and VAT and were then added to the base price to calculate the price of licit cigarettes. The licit, illicit and disposable income amounts were adjusted for inflation, taking December 2016 as the base month and year, respectively.

For the statistical analysis in sections \ref{Cointegrate} and \ref{vecm}, all of the variables have been transformed into log form to reduce variability. A price ratio has been constructed by dividing the real price of licit cigarettes by the real price of illicit cigarettes. Theory suggests that consumers are more concerned with relative price changes than absolute price changes.

Figure \ref{fig:plot} below plots the variables at levels. The graphs indicate that the series are not stationary, which is formally tested below in section \ref{Cointegrate}.

```{r readingData, echo=FALSE, warning=FALSE, message=FALSE}
# read in the data - add the dataset's path to filePath
library(readxl)
dataset <- read_excel("data/Data.xlsx", sheet = "data1")
incomeData <- read_excel("data/Data.xlsx", sheet = "real") #importing real income
source("code/data_clean.R")
log_data <- data_clean(dataset)
source("code/interpolate.R") #interpolate real income to monthly intervals and clean and log income data
monthly_income <- interpolate(incomeData)
vecm_data <- log_data %>% mutate(monthly_income$log_REAL, .before=log_YR)
colnames(vecm_data)[12] = "log_REAL"
```

```{r graphs, fig.height = 4.5, echo=FALSE, warning=FALSE, message=FALSE, fig.cap = "Plot for variables at levels \\label{fig:plot}"}
source("code/time_series_plots.R")
time_series_plots(log_data)
```

## Cointegration \label{Cointegrate}

To test whether the series are stationary, three tests were employed: the Augmented Dickey-Fuller (ADF), Kwiatkowski–Phillips–Schmidt–Shin (KPSS), and Phillip-Perron (PP) unit root tests. The results of the ADF and PP tests in figure \ref{tab:adf} and \ref{tab:pp} show that the log of the real price ratio and the log of real per capita disposable income series are non-stationary at the 5% level of significance. The KPSS test (figure \ref{tab:kp}) rejected the null hypothesis of stationarity for all three variables. However, the first two tests failall three tests show that the differenced series 

The stationarity of the time series was tested using the Augmented Dickey-
Fuller (ADF) and Phillip-Perron (PP) unit root tests. The data were con-
verted into logarithms in order to reduce their variability. Based on the ADF
and PP tests, the hypothesis that the log of per capita consumption, the log of
real prices and the log of real per capita GDP contain a unit root cannot be
rejected at a 5% signicance level. However, we fail to reject the assumption
of stationarity after rst di¤erencing these variables. The critical values for the
ADF and PP tests at  at 5% are -3.497 and -3.496 respectively.
Compared to the test-statistic values, the variables are stationary at rst di¤er-
ences (see Figures 3 and 4; Appendix 2), and thus, standard statistical inference
is validated.28 

This suggests that a cointegration approach can be used to test
for the existence of a long-run relationship between the variables.

Cointegration was then tested using the Trace and the Maximum Eigenvalue
tests.29

```{r ADFResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/adf_test.R")
dickeyFuller <- adf_test(dset)
library(broom)

Qadftest <- broom::tidy(dickeyFuller[[1]])
Padftest <- broom::tidy(dickeyFuller[[2]])
Yadftest <- broom::tidy(dickeyFuller[[3]])

dickeyTest <- as.data.frame(bind_rows(Qadftest, Padftest, Yadftest))
dickeyTest <- dickeyTest[,-3]
dickeyTest <- dickeyTest[,-3]
rownames(dickeyTest) = c("Quantity legal cigarettes", "Price ratio", "Disposable income")


library(huxtable)
dickeyTest %>%
as_hux() %>%
  theme_article() %>% 
  set_font_size(10) %>% 
  set_col_width(1, 3) %>% 
  set_align(1, everywhere, "left") %>% 
  add_rownames() %>% 
  set_caption("Augmented Dickey Fuller Tests \\label{tab:adf}") %>% 
  set_all_padding(2) 

```

```{r PPResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/pp_test.R")
pp <- pp_test(dset)
library(broom)
library(dplyr)

Qpptest <- broom::tidy(pp[[1]])
Ppptest <- broom::tidy(pp[[2]])
Ypptest <- broom::tidy(pp[[3]])

ppTest <- as.data.frame(bind_rows(Qpptest, Ppptest, Ypptest)) 
ppTest <- ppTest[,-3]
ppTest <- ppTest[,-3]#remove the third column from the dataframe
rownames(ppTest) = c("Quantity legal cigarettes", "Price ratio", "Disposable income")
colnames(ppTest)[0] <- "rowname"

library(huxtable)
ppTest %>% 
as_hux() %>% 
  theme_article() %>% 
  set_font_size(10) %>% 
  set_col_width(1, 3) %>% 
  set_align(1, everywhere, "left") %>% 
  add_rownames() %>% 
  set_caption("Phillips-Perron Unit Root Test \\label{tab:pp}") %>% 
  set_all_padding(2) 
```


```{r KPSSResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/kpss_test.R")
kp <- kpss_test(dset)
library(broom)
library(dplyr)

Qpptest <- broom::tidy(kp[[1]])
Ppptest <- broom::tidy(kp[[2]])
Ypptest <- broom::tidy(kp[[3]])

kpTest <- as.data.frame(bind_rows(Qpptest, Ppptest, Ypptest)) 
kpTest <- kpTest[,-3]
kpTest <- kpTest[,-3] #remove the third column from the dataframe
rownames(kpTest) = c("Quantity legal cigarettes", "Price ratio", "Disposable income")
colnames(kpTest)[0] <- ""
alternative <- c("non-stationary", "non-stationary", "non-stationary")
kpTest$alternative <- alternative


library(huxtable)
kpTest %>% 
as_hux() %>% 
  theme_article() %>% 
  add_rownames() %>% 
  set_font_size(10) %>% 
  set_col_width(1, 3) %>% 
  set_align(1, everywhere, "left") %>% 
  set_caption("KPSS Unit Root Test \\label{tab:kp}") %>% 
  set_all_padding(2) 
```


```{r PPdiffResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/pp_test_diff.R")
ppdiff <- pp_test_diff(dset)
library(broom)
library(dplyr)

Qpptestdiff <- broom::tidy(ppdiff[[1]])
Ppptestdiff <- broom::tidy(ppdiff[[2]])
Ypptestdiff <- broom::tidy(ppdiff[[3]])

ppTestDiff <- as.data.frame(bind_rows(Qpptestdiff, Ppptestdiff, Ypptestdiff)) 
ppTestDiff <- ppTestDiff[,-3]
ppTestDiff <- ppTestDiff[,-3] 
rownames(ppTestDiff) = c("Quantity legal cigarettes", "Price ratio", "Disposable income")
colnames(ppTestDiff)[0] <- ""

library(huxtable)
ppTestDiff  %>% 
as_hux() %>% 
  theme_article() %>% 
  add_rownames() %>% 
  set_font_size(10) %>% 
  set_col_width(2, 3) %>% 
  set_align(1, everywhere, "left") %>% 
  set_caption("Phillips-Perron Unit Root Test for Differenced Series \\label{kp}") %>% 
  set_all_padding(2) %>% 
  set_outer_padding(3)

```

```{r AdfdiffResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/adf_test_diff.R")
adfdiff <- adf_test_diff(dset)
library(broom)
library(dplyr)

Qadftestdiff <- broom::tidy(adfdiff[[1]])
Padftestdiff <- broom::tidy(adfdiff[[2]])
Yadftestdiff <- broom::tidy(adfdiff[[3]])

adfTestDiff <- as.data.frame(bind_rows(Qadftestdiff, Padftestdiff, Yadftestdiff)) 
adfTestDiff <- adfTestDiff[,-3]
adfTestDiff <- adfTestDiff[,-3] 
rownames(adfTestDiff) = c("Quantity legal cigarettes", "Price ratio", "Disposable income")

adfTestDiff <- adfTestDiff %>%                 
  mutate_if(is.numeric,
            round,
            digits = 2)

library(huxtable)
adfTestDiff  %>% 
as_hux() %>% 
  theme_article() %>%
    add_rownames() %>% 
  set_font_size(10) %>% 
  set_col_width(2, 3) %>% 
  set_align(1, everywhere, "left") %>% 
  set_caption("ADF Test for Differenced Series \\label{adfdiff}") %>% 
  set_all_padding(2) %>% 
  set_outer_padding(3)

```

```{r Coint_trace, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/coint_trace.R")
cointTrace <- coint_trace(dset)
library(broom)  
library(dplyr)


library(huxtable)
cointTrace  %>% 
as_hux() %>% 
  theme_article() %>% 
  add_rownames() %>% 
  set_font_size(10) %>% 
  set_col_width(2, 3) %>% 
  set_align(1, everywhere, "left") %>% 
  set_caption("Johansen Trace Test fo Cointegraion \\label{trace}") %>%
  set_all_padding(2) %>% 
  set_outer_padding(3)

```

```{r Coint_eigen, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/coint_eigen.R")
cointEigen <- coint_eigen(dset)
library(broom)  
library(dplyr)


library(huxtable)
cointEigen  %>% 
as_hux() %>% 
  theme_article() %>% 
  add_rownames() %>% 
  set_font_size(10) %>% 
  set_col_width(2, 3) %>% 
  set_align(1, everywhere, "left") %>% 
  set_caption("Johansen Eigen Test fo Cointegraion \\label{trace}") %>%
  set_all_padding(2) %>% 
  set_outer_padding(3)

```
\newpage
\clearpage

## VECM \label{vecm}

The price ratio captures a relative change of the legal price compared to the illicit price. If the ratio shrinks, it indicates that the cost of legal cigarettes decreased relative to the cost of illicit cigarettes. There should be a negative long run relationship between the price ratio and the quantity of legal cigarettes. There should be a positive sign for the cointegrating relationship, which there is. The coefficient for the real disposable income variable should be negative for the long-run relationship (so that the reverse sign is positive); whereas the sign is positive in the Vecm results below.

```{r VecmResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/vecm_tsDyn.R")
vecm2 <- VECM_tsDyn(dset)
source("code/tidy_vecm_results.R")
tidy_vecm <- tidy_vecm_results(vecm2)
vecm_shortrun <- tidy_vecm[[1]]
vecm_longrun <- tidy_vecm[[2]]

library(huxtable)

vecm_longrun %>% 
as_hux() %>% 
  theme_article() %>% 
  set_font_size(10) %>% 
  # set_width(1) %>% 
  set_caption("Long run coefficient") %>% 
  set_all_padding(2) 
  # set_number_format(col = 2, value = 4)

vecm_shortrun %>% 
as_hux() %>% 
  theme_article() %>% 
  set_font_size(10) %>% 
  # set_width(1) %>% 
  set_caption("Short tunrun coefficient") %>% 
  set_all_padding(2) 
  # set_number_format(col = 2, value = 4)

```

If the real disposable income variable is excluded then the Vecm results are as follows. The coefficient for 

```{r VecmResultsSingle, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
source("code/time_series_data_short.R")
dset1 <- time_series_data_short(vecm_data)

source("code/vecm_tsDyn.R")
vecm2 <- VECM_tsDyn(dset1)
source("code/tidy_vecm_results.R")
tidy_vecm1 <- tidy_vecm_results(vecm2)
vecm_shortrun1 <- tidy_vecm1[[1]]
vecm_longrun1 <- tidy_vecm1[[2]]

library(huxtable)

ht <- hux(vecm_longrun1
      ) %>% huxtable::add_rownames()

bold(ht)[1,]           <- TRUE
bottom_border(ht)[1,]  <- 0.4
align(ht)[,2]          <- "right"
right_padding(ht)      <- 2
left_padding(ht)       <- 2
width(ht)              <- 0.9
number_format(ht)      <- 2

ht

ht <- hux(vecm_shortrun1
      ) %>% huxtable::add_rownames()

bold(ht)[1,]           <- TRUE
bottom_border(ht)[1,]  <- 0.4
align(ht)[,2]          <- "right"
right_padding(ht)      <- 2
left_padding(ht)       <- 2
width(ht)              <- 0.9
number_format(ht)      <- 2

ht
```


## Residual Testing \label{residuals}

# Analysis \label{analysis}

# Conclusion \label{conclusion}




