---
output:
   pdf_document
---

# Introduction

This study examines the relationship between the legal and illegal tobacco markets in South Africa. Section \ref{data} discusses the data used and how it was cleaned. Section \ref{methodology} explains the methodology, where a VECM model is presented. The final section details discussion points (\ref{analysis}). The appendix contains the full model outputs. 


# The Illicit Tobacco Market

The health problems associated with tobacco consumption are significant and have been well-documented (Tingum et al, 2020:62). Worldwide, smoking is one of the leading causes of preventable deaths; and in South Africa 23% of the total deaths in 2018 were smoking-related (Statistics South Africa). Given the large and negative impact of smoking, the tobacco market has come under increasing scrutiny by governments and health organizations. A significant component of the tobacco market is the illicit cigarette trade, which the Financial Action Task Force (2012:7) defines as “…the supply, distribution and sale of smuggled genuine, counterfeit or cheap white tobacco products.”

The illicit tobacco market gives rise to concern on three main fronts: public health, tax evasion, and criminal activity. From a public health perspective, illicit cigarettes make smoking more affordable and thereby increases tobacco access (van der Zee et al, 2019:242). Cheaper cigarettes may induce non-smokers to smoke, increase the volume of cigarettes consumed by smokers, and decrease the likelihood that smokers will quit smoking (Pechacek et al, 2018:pagenumber; van der Zee et al, 2019:242).

According to the International Agency for Research on Cancer, tobacco use is more prevalent among low socio-economic groups, and the poor are more sensitive to cigarette prices (IARC, 2011:276). Consequently, the health problems linked to smoking are disproportionately higher among the poor, which results in a greater burden on the public healthcare sector (). In South Africa, the healthcare costs associated with smoking amounted to R14.48 billion in 2016, which accounted for 4.1% of health spending (). In addition to the healthcare costs, there are indirect costs linked to smoking such as the loss of productive lives and loss of productive days due to illness (Boachie et al, 2020). In 2016, the total cost of smoking to South Africa was R42.32 billion (0.97% of GDP).

Evidently, the public health and economic costs of tobacco use are extensive. In an effort to reduce tobacco use, many countries have implemented tax and price policies on tobacco products (Chaloupka, Straif, Leon). For a middle-income country, South Africa was considered to be at the forefront of tobacco control policies, including excise duties, for many years (Vellios ). From a fiscal perspective, excise tax on cigarettes is a source of government revenue, which is undermined by the illicit tobacco industry.  Blah ble estimates the loss of income due to the illicit market to be R123123 The loss of income


# Data \label{data}

The sample period for this study runs from January 2012 to March 2020. Monthly data is used such that there are 99 observation points for each variable in the data set. One of the advantages of using monthly data rather than annual data is that it allows for more degrees of freedom. The data used includes figures for the prices and volumes of cigarettes in South Africa, tobacco excise duties, VAT, and disposable income. To prepare the data for analysis the most popular price category (MPPC) was identified as the 20-cigarette pack. Then a weighted average of before-tax 20-pack prices was used as a base price. The excise duty per 20's pack and VAT and were then added to the base price to calculate the price of licit cigarettes. The licit, illicit and disposable income amounts were adjusted for inflation, taking December 2016 as the base month and year. All of the variables have been transformed into log form.

```{r readingData, echo=FALSE, warning=FALSE, message=FALSE}
# read in the data - add the dataset's path to filePath
library(readxl)
dataset <- read_excel("data/Data.xlsx", sheet = "data1")
incomeData <- read_excel("data/Data.xlsx", sheet = "real") #importing real income
source("code/data_clean.R")
log_data <- data_clean(dataset)
source("code/interpolate.R") #interpolate real income to monthly intervals and clean and log income data
monthly_income <- interpolate(incomeData)
vecm_data <- log_data %>% mutate(monthly_income$log_REAL, .before=log_YR)
colnames(vecm_data)[12] = "log_REAL"
```

```{r graphs, fig.height = 4.5, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_plots.R")
time_series_plots(log_data)
```

# Methodology \label{methodology}

The long-run relationship between the legal cigarette market and the illicit market is modeled as a vector error correction model 

## Stationarity \label{stationarity}

To test whether the series are stationary, three tests are employed: the augmented dickey fu

```{r stationarityResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/adf_test.R")
dickeyFuller <- adf_test(dset)
library(broom)

Qadftest <- broom::tidy(dickeyFuller[[1]])
Padftest <- broom::tidy(dickeyFuller[[2]])
Yadftest <- broom::tidy(dickeyFuller[[3]])

dickeyTest <- as.data.frame(bind_rows(Qadftest, Padftest, Yadftest))
rownames(dickeyTest) = c("Quantity legal cigarettes", "Price ratio", "Disposable income")

library(huxtable)

dickeyTest %>% 
  rename("Statistic" = statistic) %>% 
  as_hux() %>% 
  theme_article() %>% 
  set_font_size(10) %>% 
  # set_width(1) %>% 
  set_caption("Augmented Dickey Fuller Tests \\label{tab:adf}") %>% 
  set_all_padding(2) %>% 
  set_number_format(col = 2, value = 4) %>% 
  huxtable::add_rownames()

```

## Cointegration \label{cointegration}

## VECM \label{vecm}

The price ratio captures a relative change of the legal price compared to the illicit price. If the ratio shrinks, it indicates that the cost of legal cigarettes decreased relative to the cost of illicit cigarettes. There should be a negative long run relationship between the price ratio and the quantity of legal cigarettes. There should be a positive sign for the cointegrating relationship, which there is. The coefficient for the real disposable income variable should be negative for the long-run relationship (so that the reverse sign is positive); whereas the sign is positive in the Vecm results below.

```{r VecmResults, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
source("code/time_series_data.R")
dset <- time_series_data(vecm_data)

source("code/vecm_tsDyn.R")
vecm2 <- VECM_tsDyn(dset)
source("code/tidy_vecm_results.R")
tidy_vecm <- tidy_vecm_results(vecm2)
vecm_shortrun <- tidy_vecm[[1]]
vecm_longrun <- tidy_vecm[[2]]

library(huxtable)

# ht <- hux(vecm_longrun
#       ) %>% huxtable::add_rownames()
# 
# bold(ht)[1,]           <- TRUE
# bottom_border(ht)[1,]  <- 0.4
# align(ht)[,2]          <- "right"
# right_padding(ht)      <- 2
# left_padding(ht)       <- 2
# width(ht)              <- 0.9
# number_format(ht)      <- 2
# 
# ht
vecm_longrun %>% 
as_hux() %>% 
  theme_article() %>% 
  set_font_size(10) %>% 
  # set_width(1) %>% 
  set_caption("This is my caption") %>% 
  set_all_padding(2) 
  # set_number_format(col = 2, value = 4)

vecm_shortrun %>% 
as_hux() %>% 
  theme_article() %>% 
  set_font_size(10) %>% 
  # set_width(1) %>% 
  set_caption("This is my caption") %>% 
  set_all_padding(2) 
  # set_number_format(col = 2, value = 4)

# ht <- hux(vecm_shortrun
#       ) %>% huxtable::add_rownames()
# 
# bold(ht)[1,]           <- TRUE
# bottom_border(ht)[1,]  <- 0.4
# align(ht)[,2]          <- "right"
# right_padding(ht)      <- 2
# left_padding(ht)       <- 2
# width(ht)              <- 0.9
# number_format(ht)      <- 2
# 
# ht
```

If the real disposable income variable is excluded then the Vecm results are as follows. The coefficient for 

```{r VecmResultsSingle, comment=NA, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
source("code/time_series_data_short.R")
dset1 <- time_series_data_short(vecm_data)

source("code/vecm_tsDyn.R")
vecm2 <- VECM_tsDyn(dset1)
source("code/tidy_vecm_results.R")
tidy_vecm1 <- tidy_vecm_results(vecm2)
vecm_shortrun1 <- tidy_vecm1[[1]]
vecm_longrun1 <- tidy_vecm1[[2]]

library(huxtable)

ht <- hux(vecm_longrun1
      ) %>% huxtable::add_rownames()

bold(ht)[1,]           <- TRUE
bottom_border(ht)[1,]  <- 0.4
align(ht)[,2]          <- "right"
right_padding(ht)      <- 2
left_padding(ht)       <- 2
width(ht)              <- 0.9
number_format(ht)      <- 2

ht

ht <- hux(vecm_shortrun1
      ) %>% huxtable::add_rownames()

bold(ht)[1,]           <- TRUE
bottom_border(ht)[1,]  <- 0.4
align(ht)[,2]          <- "right"
right_padding(ht)      <- 2
left_padding(ht)       <- 2
width(ht)              <- 0.9
number_format(ht)      <- 2

ht
```

## Residual Testing \label{residuals}

# Analysis \label{analysis}

# Conclusion \label{conclusion}




